<mvc:View
	controllerName="cds.plugin.caching.dashboard.controller.Keys"
	displayBlock="true"
	xmlns="sap.m"
	xmlns:mvc="sap.ui.core.mvc"
	xmlns:core="sap.ui.core"
	xmlns:l="sap.ui.layout"
	xmlns:f="sap.f"
	xmlns:card="sap.f.cards"
	xmlns:table="sap.ui.table"
	core:require="{
		formatter: 'cds/plugin/caching/dashboard/model/formatter'
	}">

	<Page
		title="Key Analysis"
		showNavButton="true"
		navButtonPress="onNavBack"
		id="keysPage">
		
		<headerContent>
			<Button 
				icon="sap-icon://refresh" 
				text="Refresh" 
				press="onRefresh"
				type="Emphasized" />
		</headerContent>

		<content>
			<l:VerticalLayout width="100%">
				
				<!-- Key Statistics -->
				<f:Card class="sapUiTinyMargin">
					<f:header>
						<card:Header title="Key Statistics" subtitle="Cache Key Analysis" />
					</f:header>
					<f:content>
						<l:VerticalLayout class="sapUiTinyMargin">
							<l:HorizontalLayout>
								<ObjectStatus
									title="Total Keys Tracked"
									text="{ui>/totalKeys}"
									state="Information"
									class="sapUiTinyMarginEnd" />
								<ObjectStatus
									title="Most Active Key"
									text="{ui>/mostActiveKey}"
									state="Success"
									class="sapUiTinyMarginEnd" />
								<ObjectStatus
									title="Least Active Key"
									text="{ui>/leastActiveKey}"
									state="Warning" />
							</l:HorizontalLayout>
							
							<!-- Data Type Distribution -->
							<l:HorizontalLayout class="sapUiTinyMarginTop">
								<Text text="Data Type Distribution: " class="sapUiTinyMarginEnd" />
								<HBox>
									<ObjectStatus
										text="Query: {ui>/dataTypeStats/0/count}"
										state="Success"
										class="sapUiTinyMarginEnd" />
									<ObjectStatus
										text="Function: {ui>/dataTypeStats/1/count}"
										state="Information"
										class="sapUiTinyMarginEnd" />
									<ObjectStatus
										text="Request: {ui>/dataTypeStats/2/count}"
										state="Warning"
										class="sapUiTinyMarginEnd" />
									<ObjectStatus
										text="Custom: {ui>/dataTypeStats/3/count}"
										state="None" />
								</HBox>
							</l:HorizontalLayout>
						</l:VerticalLayout>
					</f:content>
				</f:Card>

				<!-- Top Accessed Keys -->
				<f:Card class="sapUiTinyMargin">
					<f:header>
						<card:Header title="Top Accessed Keys" subtitle="Most Frequently Used Cache Keys" />
					</f:header>
					<f:content>
						<Table
							id="topKeysTable"
							items="{ui>/topKeys}"
							busyIndicatorDelay="0"
							busy="{ui>/loading}">
							<columns>
								<Column width="200px">
									<Text text="Key Name" />
								</Column>
								<Column width="80px">
									<Text text="Type" />
								</Column>
								<Column width="120px">
									<Text text="Service" />
								</Column>
								<Column width="120px">
									<Text text="Entity" />
								</Column>
								<Column width="100px">
									<Text text="Operation" />
								</Column>
								<Column width="60px">
									<Text text="Hits" />
								</Column>
								<Column width="60px">
									<Text text="Misses" />
								</Column>
								<Column width="60px">
									<Text text="Sets" />
								</Column>
								<Column width="60px">
									<Text text="Deletes" />
								</Column>
								<Column width="60px">
									<Text text="Total" />
								</Column>
								<Column width="150px">
									<Text text="Last Access" />
								</Column>
							</columns>
							<items>
								<ColumnListItem>
									<cells>
										<Text text="{formatter: 'formatter.formatKeyName', path: 'ui>keyName'}" tooltip="{ui>keyName}" />
										<ObjectStatus
											text="{ui>dataType}"
											state="{= ${ui>dataType} === 'query' ? 'Success' : ${ui>dataType} === 'function' ? 'Information' : ${ui>dataType} === 'request' ? 'Warning' : 'None'}" />
										<Text text="{ui>serviceName}" />
										<Text text="{ui>entityName}" />
										<Text text="{ui>operation}" />
										<Text text="{ui>hits}" />
										<Text text="{ui>misses}" />
										<Text text="{ui>sets}" />
										<Text text="{ui>deletes}" />
										<Text text="{ui>total}" />
										<Text text="{formatter: 'formatter.formatDate', path: 'ui>lastAccess'}" />
									</cells>
								</ColumnListItem>
							</items>
						</Table>
					</f:content>
				</f:Card>

				<!-- Cold Keys -->
				<f:Card class="sapUiTinyMargin">
					<f:header>
						<card:Header title="Cold Keys" subtitle="Least Recently Used Cache Keys" />
					</f:header>
					<f:content>
						<Table
							id="coldKeysTable"
							items="{ui>/coldKeys}"
							busyIndicatorDelay="0"
							busy="{ui>/loading}">
							<columns>
								<Column width="200px">
									<Text text="Key Name" />
								</Column>
								<Column width="80px">
									<Text text="Type" />
								</Column>
								<Column width="120px">
									<Text text="Service" />
								</Column>
								<Column width="120px">
									<Text text="Entity" />
								</Column>
								<Column width="100px">
									<Text text="Operation" />
								</Column>
								<Column width="60px">
									<Text text="Hits" />
								</Column>
								<Column width="60px">
									<Text text="Misses" />
								</Column>
								<Column width="60px">
									<Text text="Sets" />
								</Column>
								<Column width="60px">
									<Text text="Deletes" />
								</Column>
								<Column width="60px">
									<Text text="Total" />
								</Column>
								<Column width="150px">
									<Text text="Last Access" />
								</Column>
							</columns>
							<items>
								<ColumnListItem>
									<cells>
										<Text text="{formatter: 'formatter.formatKeyName', path: 'ui>keyName'}" tooltip="{ui>keyName}" />
										<ObjectStatus
											text="{ui>dataType}"
											state="{= ${ui>dataType} === 'query' ? 'Success' : ${ui>dataType} === 'function' ? 'Information' : ${ui>dataType} === 'request' ? 'Warning' : 'None'}" />
										<Text text="{ui>serviceName}" />
										<Text text="{ui>entityName}" />
										<Text text="{ui>operation}" />
										<Text text="{ui>hits}" />
										<Text text="{ui>misses}" />
										<Text text="{ui>sets}" />
										<Text text="{ui>deletes}" />
										<Text text="{ui>total}" />
										<Text text="{formatter: 'formatter.formatDate', path: 'ui>lastAccess'}" />
									</cells>
								</ColumnListItem>
							</items>
						</Table>
					</f:content>
				</f:Card>

			</l:VerticalLayout>
		</content>

	</Page>

</mvc:View> 