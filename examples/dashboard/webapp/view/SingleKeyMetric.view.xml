<mvc:View controllerName="cds.plugin.caching.dashboard.controller.SingleKeyMetric"
	xmlns="sap.m"
	xmlns:mvc="sap.ui.core.mvc"
	xmlns:core="sap.ui.core"
	xmlns:l="sap.ui.layout"
	xmlns:f="sap.f"
	xmlns:fb="sap.ui.comp.filterbar"
	xmlns:card="sap.f.cards"
	xmlns:cssgrid="sap.ui.layout.cssgrid"
	xmlns:viz="sap.viz.ui5.controls"
	xmlns:viz.feeds="sap.viz.ui5.controls.common.feeds"
	xmlns:viz.data="sap.viz.ui5.data"
	xmlns:form="sap.ui.layout.form" core:require="{
		formatter: 'cds/plugin/caching/dashboard/model/formatter'
	}">

	<f:DynamicPage title="Key Metric Details" showFooter="false">
		<f:title>
			<f:DynamicPageTitle>
				<f:heading>
					<Title text="Key: {ui>/keyName}" />
				</f:heading>
				<f:actions>
					<Button icon="sap-icon://refresh" text="Refresh" type="Transparent" press="onRefresh" />
				</f:actions>
				<f:navigationActions>
					<OverflowToolbarButton type="Transparent" icon="sap-icon://full-screen" press="handleFullScreen" tooltip="Enter Full Screen Mode" visible="{= ${app>/layout} !== 'EndColumnFullScreen' }"/>
					<OverflowToolbarButton type="Transparent" icon="sap-icon://exit-full-screen" press="handleExitFullScreen" tooltip="Exit Full Screen Mode" visible="{= ${app>/layout} === 'EndColumnFullScreen' }"/>
					<OverflowToolbarButton type="Transparent" icon="sap-icon://decline" press="handleClose" tooltip="Close end column"/>
				</f:navigationActions>
			</f:DynamicPageTitle>
		</f:title>

		<f:content>
			<cssgrid:CSSGrid id="keyMetricMainGrid" width="100%">
				<cssgrid:customLayout>
					<cssgrid:ResponsiveColumnLayout />
				</cssgrid:customLayout>

				<!-- Key Information Section -->
				<VBox renderType="Bare">
					<layoutData>
						<cssgrid:ResponsiveColumnItemLayoutData columns="24"/>
					</layoutData>

					<Title text="Key Information" titleStyle="H5" class="sapUiMediumMarginTop sapUiTinyMarginBottom" />

					<f:GridContainer id="keyInfoGrid" columnsChange=".onColumnsChange">
						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Key Name" subheader="Cache Key">
							<TileContent>
								<NumericContent value="{ui>/keyName}" withMargin="false" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="3" minRows="2"/>
							</layoutData>
						</GenericTile>

						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Operation Type" subheader="Access Pattern">
							<TileContent>
								<NumericContent value="{ui>/operationType}" withMargin="false" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="2" minRows="2"/>
							</layoutData>
						</GenericTile>

						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Operations" subheader="Cache Service Operations">
							<TileContent>
								<NumericContent value="{ui>/operation}" withMargin="false" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="3" minRows="2"/>
							</layoutData>
						</GenericTile>

						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Data Type" subheader="Content Type">
							<TileContent>
								<NumericContent value="{ui>/dataType}" withMargin="false" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="2" minRows="2"/>
							</layoutData>
						</GenericTile>

						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Service Name" subheader="Source Service">
							<TileContent>
								<NumericContent value="{ui>/serviceName}" withMargin="false" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="3" minRows="2"/>
							</layoutData>
						</GenericTile>

						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Entity Name" subheader="Data Entity">
							<TileContent>
								<NumericContent value="{ui>/entityName}" withMargin="false" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="3" minRows="2"/>
							</layoutData>
						</GenericTile>

						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Last Access" subheader="Most Recent Access">
							<TileContent>
								<NumericContent value="{ui>/lastAccess}" withMargin="false" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="3" minRows="2"/>
							</layoutData>
						</GenericTile>

						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="First Access" subheader="Initial Access">
							<TileContent>
								<NumericContent value="{ui>/timestamp}" withMargin="false" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="3" minRows="2"/>
							</layoutData>
						</GenericTile>

						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Tenant" subheader="Tenant Information">
							<TileContent>
								<NumericContent value="{ui>/tenant}" withMargin="false" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="2" minRows="2"/>
							</layoutData>
						</GenericTile>

						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="User" subheader="User Information">
							<TileContent>
								<NumericContent value="{ui>/user}" withMargin="false" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="2" minRows="2"/>
							</layoutData>
						</GenericTile>

						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Locale" subheader="Locale Information">
							<TileContent>
								<NumericContent value="{ui>/locale}" withMargin="false" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="2" minRows="2"/>
							</layoutData>
						</GenericTile>
					</f:GridContainer>
				</VBox>

				<!-- Read-Through Performance Section -->
				<VBox renderType="Bare">
					<layoutData>
						<cssgrid:ResponsiveColumnItemLayoutData columns="24"/>
					</layoutData>

					<Title text="Read-Through Performance" titleStyle="H5" class="sapUiMediumMarginTop sapUiTinyMarginBottom" />

					<f:GridContainer id="keyMetricCacheThroughGrid" columnsChange=".onColumnsChange">
						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Hit Ratio" subheader="Cache Hit Rate">
							<TileContent unit="%">
								<NumericContent valueColor="{formatter: 'formatter.formatHitRatioWithColor', path: 'ui>/hitRatio'}" value="{ path: 'ui>/hitRatio', type: 'sap.ui.model.type.Float', formatOptions: {style: 'short', decimals: 2}}" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="2" minRows="2"/>
							</layoutData>
						</GenericTile>

						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Cache Efficiency" subheader="Performance Factor">
							<TileContent unit="x">
								<NumericContent valueColor="{formatter: 'formatter.formatCacheEfficiencyWithColor', path: 'ui>/cacheEfficiency'}" value="{path: 'ui>/cacheEfficiency', type: 'sap.ui.model.type.Float', formatOptions: {style: 'short', decimals: 2}}" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="2" minRows="2"/>
							</layoutData>
						</GenericTile>

						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Throughput" subheader="Requests per Second">
							<TileContent unit="req/s">
								<NumericContent value="{ path: 'ui>/throughput', type: 'sap.ui.model.type.Float', formatOptions: {style: 'short', decimals: 2}}" withMargin="false" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="2" minRows="2"/>
							</layoutData>
						</GenericTile>

						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Error Rate" subheader="Cache Errors">
							<TileContent unit="%">
								<NumericContent valueColor="{formatter: 'formatter.formatErrorRateWithColor', path: 'ui>/errorRate'}" value="{ path: 'ui>/errorRate', formatter: 'formatter.formatPercentageValue' }" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="2" minRows="2"/>
							</layoutData>
						</GenericTile>

						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Total Requests" subheader="Cache Operations">
							<TileContent unit="req">
								<NumericContent value="{ui>/totalRequests}" withMargin="false" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="2" minRows="2"/>
							</layoutData>
						</GenericTile>

						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Cache Hits" subheader="Successful Retrievals">
							<TileContent unit="hits">
								<NumericContent value="{ui>/hits}" withMargin="false" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="2" minRows="2"/>
							</layoutData>
						</GenericTile>

						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Cache Misses" subheader="Failed Retrievals">
							<TileContent unit="misses">
								<NumericContent value="{ui>/misses}" withMargin="false" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="2" minRows="2"/>
							</layoutData>
						</GenericTile>

						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Cache Sets" subheader="Write Operations">
							<TileContent unit="sets">
								<NumericContent value="{ui>/sets}" withMargin="false" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="2" minRows="2"/>
							</layoutData>
						</GenericTile>

						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Cache Deletes" subheader="Delete Operations">
							<TileContent unit="deletes">
								<NumericContent value="{ui>/deletes}" withMargin="false" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="2" minRows="2"/>
							</layoutData>
						</GenericTile>

						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Cache Errors" subheader="Error Count">
							<TileContent unit="errors">
								<NumericContent value="{ui>/errors}" withMargin="false" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="2" minRows="2"/>
							</layoutData>
						</GenericTile>

						<!-- Read-Through Distribution Chart -->
						<f:Card class="sapUiTinyMargin">
							<f:header>
								<card:Header title="Read-Through Operations" subtitle="Hit/Miss/Error Distribution" />
							</f:header>
							<f:content>
								<l:VerticalLayout width="100%">
									<viz:Popover id="keyMetricCacheThroughPopOver"></viz:Popover>
									<viz:VizFrame id="keyMetricCacheThroughChart" vizType="pie" width="100%" height="300px">
										<viz:dataset>
											<viz.data:FlattenedDataset data="{ui>/cacheThroughData}">
												<viz.data:dimensions>
													<viz.data:DimensionDefinition name="Operation" value="{operation}" />
												</viz.data:dimensions>
												<viz.data:measures>
													<viz.data:MeasureDefinition name="Count" value="{count}" />
												</viz.data:measures>
											</viz.data:FlattenedDataset>
										</viz:dataset>
										<viz:feeds>
											<viz.feeds:FeedItem id="keyMetricCacheThroughValueAxisFeed" uid="size" type="Measure" values="Count" />
											<viz.feeds:FeedItem id="keyMetricCacheThroughCategoryAxisFeed" uid="color" type="Dimension" values="Operation" />
										</viz:feeds>
									</viz:VizFrame>
								</l:VerticalLayout>
							</f:content>
							<f:layoutData>
								<f:GridContainerItemLayoutData columns="4" minRows="4"/>
							</f:layoutData>
						</f:Card>

						<!-- Latency Chart -->
						<f:Card class="sapUiTinyMargin">
							<f:header>
								<card:Header title="Latency Comparison" subtitle="Read-Through Latency Metrics" />
							</f:header>
							<f:content>
								<l:VerticalLayout width="100%">
									<viz:Popover id="keyMetricLatencyPopOver"></viz:Popover>
									<viz:VizFrame id="keyMetricLatencyChart" vizType="bar" width="100%" height="300px">
										<viz:dataset>
											<viz.data:FlattenedDataset data="{ui>/latencyData}">
												<viz.data:dimensions>
													<viz.data:DimensionDefinition name="Operation" value="{operation}" />
												</viz.data:dimensions>
												<viz.data:measures>
													<viz.data:MeasureDefinition name="Latency" value="{latency}" />
												</viz.data:measures>
											</viz.data:FlattenedDataset>
										</viz:dataset>
										<viz:feeds>
											<viz.feeds:FeedItem id="keyMetricValueAxisFeed" uid="valueAxis" type="Measure" values="Latency" />
											<viz.feeds:FeedItem id="keyMetricCategoryAxisFeed" uid="categoryAxis" type="Dimension" values="Operation" />
										</viz:feeds>
									</viz:VizFrame>
								</l:VerticalLayout>
							</f:content>
							<f:layoutData>
								<f:GridContainerItemLayoutData columns="12" minRows="4"/>
							</f:layoutData>
						</f:Card>

						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Hit Latency" subheader="Cache Hit Response">
							<TileContent unit="ms">
								<NumericContent valueColor="{formatter: 'formatter.formatLatencyWithColor', path: 'ui>/avgHitLatency'}" value="{ path: 'ui>/avgHitLatency', type: 'sap.ui.model.type.Float', formatOptions: {style: 'short', decimals: 2}}" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="2" minRows="2"/>
							</layoutData>
						</GenericTile>

						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Miss Latency" subheader="Cache Miss Response">
							<TileContent unit="ms">
								<NumericContent valueColor="{formatter: 'formatter.formatLatencyWithColor', path: 'ui>/avgMissLatency'}" value="{ path: 'ui>/avgMissLatency', type: 'sap.ui.model.type.Float', formatOptions: {style: 'short', decimals: 2}}" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="2" minRows="2"/>
							</layoutData>
						</GenericTile>

						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Set Latency" subheader="Write Operations">
							<TileContent unit="ms">
								<NumericContent valueColor="{formatter: 'formatter.formatLatencyWithColor', path: 'ui>/avgSetLatency'}" value="{ path: 'ui>/avgSetLatency', type: 'sap.ui.model.type.Float', formatOptions: {style: 'short', decimals: 2}}" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="2" minRows="2"/>
							</layoutData>
						</GenericTile>

						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Delete Latency" subheader="Delete Operations">
							<TileContent unit="ms">
								<NumericContent valueColor="{formatter: 'formatter.formatLatencyWithColor', path: 'ui>/avgDeleteLatency'}" value="{ path: 'ui>/avgDeleteLatency', type: 'sap.ui.model.type.Float', formatOptions: {style: 'short', decimals: 2}}" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="2" minRows="2"/>
							</layoutData>
						</GenericTile>

					</f:GridContainer>
				</VBox>

				<!-- Native Function Performance Section -->
				<VBox renderType="Bare">
					<layoutData>
						<cssgrid:ResponsiveColumnItemLayoutData columns="24"/>
					</layoutData>

					<Title text="Native Function Performance" titleStyle="H5" class="sapUiMediumMarginTop sapUiTinyMarginBottom" />

					<f:GridContainer id="keyMetricNativeGrid" columnsChange=".onColumnsChange">
						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Native Throughput" subheader="Operations per Second">
							<TileContent unit="ops/s">
								<NumericContent value="{ path: 'ui>/nativeThroughput', formatter: 'formatter.formatNumberValue' }" withMargin="false" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="2" minRows="2"/>
							</layoutData>
						</GenericTile>

						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Native Error Rate" subheader="Native Function Errors">
							<TileContent unit="%">
								<NumericContent valueColor="{formatter: 'formatter.formatErrorRateWithColor', path: 'ui>/nativeErrorRate'}" value="{ path: 'ui>/nativeErrorRate', formatter: 'formatter.formatPercentageValue' }" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="2" minRows="2"/>
							</layoutData>
						</GenericTile>

						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Native Sets" subheader="Write Operations">
							<TileContent unit="sets">
								<NumericContent value="{ui>/nativeSets}" withMargin="false" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="2" minRows="2"/>
							</layoutData>
						</GenericTile>

						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Native Gets" subheader="Read Operations">
							<TileContent unit="gets">
								<NumericContent value="{ui>/nativeGets}" withMargin="false" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="2" minRows="2"/>
							</layoutData>
						</GenericTile>

						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Native Deletes" subheader="Delete Operations">
							<TileContent unit="deletes">
								<NumericContent value="{ui>/nativeDeletes}" withMargin="false" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="2" minRows="2"/>
							</layoutData>
						</GenericTile>

						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Native Clears" subheader="Clear Operations">
							<TileContent unit="clears">
								<NumericContent value="{ui>/nativeClears}" withMargin="false" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="2" minRows="2"/>
							</layoutData>
						</GenericTile>

						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Delete By Tags" subheader="Tag-based Deletes">
							<TileContent unit="deletes">
								<NumericContent value="{ui>/nativeDeleteByTags}" withMargin="false" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="2" minRows="2"/>
							</layoutData>
						</GenericTile>

						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Native Errors" subheader="Error Count">
							<TileContent unit="errors">
								<NumericContent value="{ui>/nativeErrors}" withMargin="false" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="2" minRows="2"/>
							</layoutData>
						</GenericTile>

						<GenericTile class="sapUiTinyMarginBegin sapUiTinyMarginTop tileLayout" header="Total Native Ops" subheader="All Operations">
							<TileContent unit="ops">
								<NumericContent value="{ui>/totalNativeOperations}" withMargin="false" />
							</TileContent>
							<layoutData>
								<f:GridContainerItemLayoutData columns="2" minRows="2"/>
							</layoutData>
						</GenericTile>

						<!-- Native Function Distribution Chart -->
						<f:Card class="sapUiTinyMargin">
							<f:header>
								<card:Header title="Native Function Operations" subtitle="Hit/Miss/Error Distribution" />
							</f:header>
							<f:content>
								<l:VerticalLayout width="100%">
									<viz:Popover id="keyMetricNativePopOver"></viz:Popover>
									<viz:VizFrame id="keyMetricNativeChart" vizType="pie" width="100%" height="300px">
										<viz:dataset>
											<viz.data:FlattenedDataset data="{ui>/nativeData}">
												<viz.data:dimensions>
													<viz.data:DimensionDefinition name="Operation" value="{operation}" />
												</viz.data:dimensions>
												<viz.data:measures>
													<viz.data:MeasureDefinition name="Count" value="{count}" />
												</viz.data:measures>
											</viz.data:FlattenedDataset>
										</viz:dataset>
										<viz:feeds>
											<viz.feeds:FeedItem id="keyMetricNativeValueAxisFeed" uid="size" type="Measure" values="Count" />
											<viz.feeds:FeedItem id="keyMetricNativeCategoryAxisFeed" uid="color" type="Dimension" values="Operation" />
										</viz:feeds>
									</viz:VizFrame>
								</l:VerticalLayout>
							</f:content>
							<f:layoutData>
								<f:GridContainerItemLayoutData columns="4" minRows="4"/>
							</f:layoutData>
						</f:Card>
					</f:GridContainer>
				</VBox>

			</cssgrid:CSSGrid>
		</f:content>
	</f:DynamicPage>

</mvc:View> 